<!DOCTYPE html>
<!-- 
Template Name: Metronic - Responsive Admin Dashboard Template build with Twitter Bootstrap 3.3.5
Version: 4.1.0
Author: KeenThemes
Website: http://www.keenthemes.com/
Contact: support@keenthemes.com
Follow: www.twitter.com/keenthemes
Like: www.facebook.com/keenthemes
Purchase: http://themeforest.net/item/metronic-responsive-admin-dashboard-template/4021469?ref=keenthemes
License: You must have a valid license purchased only from themeforest(the above link) in order to legally use the theme for your project.
-->
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<!-- BEGIN HEAD -->

<head>
	<meta charset="utf-8" />
	<title>Metronic | UI Features - Block UI</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta content="width=device-width, initial-scale=1.0" name="viewport" />
	<meta http-equiv="Content-type" content="text/html; charset=utf-8">
	<meta content="" name="description" />
	<meta content="" name="author" />
	<!-- BEGIN GLOBAL MANDATORY STYLES -->
	<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700&subset=all" rel="stylesheet"
		type="text/css">
	<link href="./plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
	<link href="./plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css">
	<link href="./plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css">
	<link href="./plugins/uniform/css/uniform.default.css" rel="stylesheet" type="text/css">
    <link href="./plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css" />
    <link href="./plugins/jquery-nestable/jquery.nestable.css"/ rel="stylesheet" type="text/css">
    
	<!-- END GLOBAL MANDATORY STYLES -->
	
	<link href="./css/components-rounded.css" id="style_components" rel="stylesheet" type="text/css" />
	<link rel="stylesheet" type="text/css" href="./plugins/bootstrap-toastr/toastr.min.css"/>

	<link href="./plugins/bootstrap-modal/css/bootstrap-modal-bs3patch.css" rel="stylesheet" type="text/css"/>
	<link href="./plugins/bootstrap-modal/css/bootstrap-modal.css" rel="stylesheet" type="text/css"/>

	<!-- BEGIN THEME STYLES -->
	<link href="./css/components-rounded.css" id="style_components" rel="stylesheet" type="text/css" />
	<link href="./css/plugins.css" rel="stylesheet" type="text/css" />
	<link href="./css/layout.css" rel="stylesheet" type="text/css" />
	<link id="style_color" href="./css/themes/light.css" rel="stylesheet" type="text/css" />
	<link href="./css/custom.css" rel="stylesheet" type="text/css" />
	<!-- END THEME STYLES -->
    <link rel="shortcut icon" href="favicon.ico" />
    
    <style>
		.col-md-3{width: 21vw}
		.col-md-6{width: 42vw}
		.col-md-9{width: 63vw}
		.col-md-12{width: 84vw}
		.col-md-15{width: 105vw}

        .card_box > .row{width: 100%; margin-bottom: 20px; padding: 20px 0}
        .full_width{width: max-content;}

		.dd-handle{background: transparent; border: 0;}
		.dd3-content{height: auto;}
		.dd3-content:hover{color: #333333;background-color: #E5E5E5;}

        .node_add{display: flex; align-items: center; justify-content: center}
		.node_add .fa{font-size: 40px;}
		
		.btn_group{padding-bottom: 10px;}

		.dd3-item{margin-bottom: 10px;}

		small{display: block;font-size: 14px; margin: 10px 0; line-height: 18px;}

		div::-webkit-scrollbar {width: 8px; height: 8px; background-color: #e5e5e5;border-radius:10px;}
        div::-webkit-scrollbar-track {border-radius:10px;}
        div::-webkit-scrollbar-thumb {border-radius:10px; background: #fff;}
    </style>
</head>
<!-- END HEAD -->
<!-- BEGIN BODY -->

<body class="page-sidebar-closed-hide-logo ">
	<!-- BEGIN CONTAINER -->
	<div class="page-container">
		<div class="page-head">
			<!-- BEGIN PAGE TITLE -->
			<div class="page-title">
				<h1></h1>
				<small class="text-blue"></small>
			</div>
			<!-- END PAGE TITLE -->
		</div>
		<!-- BEGIN CONTENT -->
		<div class="page-content">
			<div class="btn_group">
				<div class="row">
					<div class="col-md-6 btn-group btn-group-solid">
						<button type="button" class="btn blue" onclick="app.methods.create()"  data-toggle="modal" data-target="#responsive">新增阶段</button>
						<button type="button" class="btn yellow" onclick="app.methods.create()"  data-toggle="modal" data-target="#responsive">新增节点</button>
					</div>
					<div class="col-md-6 btn-group btn-group-solid" style="display: inline-flex; justify-content: flex-end;">
						<!-- <button type="button" class="btn green" onclick="app.methods.create()"  data-toggle="modal" data-target="#responsive">保存修改</button> -->
						<button type="button" class="btn green" onclick="app.methods.save()"  data-toggle="modal" data-target="#responsive">保存并退出</button>
						<button type="button" class="btn red" onclick="app.methods.end()"  data-toggle="modal" data-target="#responsive">退出编辑</button>
					</div>
				</div>
			</div>
			<div class="card_box">
				<div class="card_box1"></div>
				<div class="card_box2"></div>
			</div>
			<!-- END PAGE CONTENT-->
		</div>
		<!-- END CONTENT -->
	</div>
	<!-- END CONTAINER -->
	<!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->
	<!-- BEGIN CORE PLUGINS -->
	<!--[if lt IE 9]>
	<script src="./plugins/respond.min.js"></script>
	<script src="./plugins/excanvas.min.js"></script> 
	<![endif]-->
	<script src="./plugins/jquery.min.js" type="text/javascript"></script>
	<script src="./plugins/jquery-migrate.min.js" type="text/javascript"></script>
	<!-- IMPORTANT! Load jquery-ui.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->
	<script src="./plugins/jquery-ui/jquery-ui.min.js" type="text/javascript"></script>
	<script src="./plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
	<script src="./plugins/bootstrap-hover-dropdown/bootstrap-hover-dropdown.min.js" type="text/javascript"></script>
	<script src="./plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
	<script src="./plugins/jquery.blockui.min.js" type="text/javascript"></script>
	<script src="./plugins/jquery.cokie.min.js" type="text/javascript"></script>
	<script src="./plugins/uniform/jquery.uniform.min.js" type="text/javascript"></script>
    <script src="./plugins/jquery-nestable/jquery.nestable.js"></script>
    <script src="./plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>
	
	<script src="./plugins/bootstrap-toastr/toastr.min.js"></script>

	<script src="./plugins/bootstrap-modal/js/bootstrap-modalmanager.js" type="text/javascript"></script>
	<script src="./plugins/bootstrap-modal/js/bootstrap-modal.js" type="text/javascript"></script>

	<!-- END CORE PLUGINS -->
	<script src="./js/metronic.js" type="text/javascript"></script>
	<script src="./js/common.js" type="text/javascript"></script>

    <script src="./js/layout.js" type="text/javascript"></script>
	<script>      
        var app = {
            data: {
				id: tools.getURLParam('id'),
				color: ['red','blue','green','yellow','purple'],
				card_parallel: [{
					id: 1001,
                    title: '并行阶段1',
                    from: 1,
                    to: 4,
                    node:[{
                        id: 1,
                        text: '测试1',
                    },{
                        id: 2,
                        text: '测试2',
                    },{
                        id: 3,
                        text: '测试3',
                    },{
                        id: 4,
                        text: '测试4',
                    }]
                },{
					id: 1002,
					title: '并行阶段2',
					from: 0,
                    to: 2,
                    node:[{
                        id: 11,
                        text: '测试11',
                    },{
                        id: 21,
                        text: '测试21',
                    },{
                        id: 31,
                        text: '测试31',
                    },{
                        id: 41,
                        text: '测试41',
                    }]
                }],
                card_main: [{
					id: 1,
                    title: '阶段1',
                    node:[{
                        id: 1,
                        text: '第一阶段可并联或并行办理事项第一阶段可并联或并行办理事项第一阶段可并联或并行办理事项',
                    },{
                        id: 2,
                        text: '测试2',
                    },{
                        id: 3,
                        text: '测试3',
                    },{
                        id: 4,
                        text: '测试4',
                    }]
                },{
					id: 2,
                    title: '阶段2',
                    node:[{
                        id: 11,
                        text: '测试11',
                    },{
                        id: 21,
                        text: '测试21',
                    },{
                        id: 31,
                        text: '测试31',
                    },{
                        id: 41,
                        text: '测试41',
                    }]
                },{
					id: 3,
                    title: '阶段3',
                    node:[{
                        id: 11,
                        text: '测试11',
                    },{
                        id: 21,
                        text: '测试21',
                    },{
                        id: 31,
                        text: '测试31',
                    },{
                        id: 41,
                        text: '测试41',
                    }]
                }],
                card_sort: [],
				max_node_len: 8,
				title: '邢台市政府投资工程建设项目审批服务流程图（新增建设用地）',
				description: '1、本流程图适用于房屋建筑和市政基础设施工程建设项目，交通、水利、能源等专业领域的工程建设项目审批流程图由相关行业主管部门另行制定2、本流程图仅包括工程建设项目主要审批事项，未涵盖所有审批事项；部分事项办理时序并非法定前后置关系。3、行政审批并行办理事项、技术审查或中介服务事项与行政审批主流程事项并联或并行办理，不另行计算用时。',
            },
            methods: {
				nodeHtml: function(data){
					var _html = ''
					data.map((_e, _i)=>{
						_html += `<li class="dd-item dd3-item" data-id="${_e.id}">
							<div class="dd-handle dd3-handle"></div>
							<div class="dd3-content alert alert-success alert-dismissable">${_e.text}</div>
						</li>`
					})
					return `<ol class="dd-list">${_html}</ol>`
				},
                initNestableHtml: function(){
					var html_main = '<div class="row"><div class="full_width">'
					// 主流程
					app.data.card_main = app.data.card_main.concat(app.data.card_main)
                    app.data.card_main.map((e, i)=>{
                        app.data.card_sort.push([])
						// ${app.data.color[i % app.data.color.length]}
						html_main += `
							<div class="col-md-3">
								<div class="portlet light">
									<div class="portlet-title">
										<div class="caption">
											<span class="caption-subject font-${app.data.color[i % app.data.color.length]}  bold uppercase">${e.title}</span>
										</div>
										<div class="tools">
											<a href="javascript:;" class="collapse" data-original-title="" title=""></a>
											<a href="#portlet-config" data-toggle="modal" class="config" data-original-title="" title=""></a>
										</div>
									</div>
									<div class="portlet-body">
										<div class="dd" id="nestable_list_${i}">${app.methods.nodeHtml(e.node)}</div>
									</div>
								</div>
							</div>
						`
					})
					html_main += '</div></div>'
					$('.card_box1').html(html_main)

					// 并行流程
					var html_parallel = ''
                    app.data.card_parallel.map((e, i)=>{
						var html_left = ''
						var left_data = new Array(e.from - 0)
						left_data.fill(0, 0, left_data.length)
						left_data.map((_e, _i)=>{
							html_left += '<div class="col-md-3"></div>'
						})
						html_parallel += `
							<div class="row">
								<div class="full_width">
									${html_left}
									<div class="col-md-${(e.to - e.from) * 3}">
										<div class="portlet light">
											<div class="portlet-title">
												<div class="caption">
													<span class="caption-subject font-red-sunglo bold uppercase">${e.title}</span>
													<span class="caption-helper"></span>
												</div>
												<div class="tools">
													<a href="javascript:;" class="collapse" data-original-title="" title=""></a>
													<a href="#portlet-config" data-toggle="modal" class="config" data-original-title="" title=""></a>
												</div>
											</div>
											<div class="portlet-body">
												<div class="dd" id="nestable_parallel_${i}">${app.methods.nodeHtml(e.node)}</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						`
					})
					$('.card_box2').html(html_parallel)

					// 节点拖拽
                    app.data.card_main.map(function(e, i){
                        $('#nestable_list_' + i).nestable()
					})
					app.data.card_parallel.map(function(e, i){
                        $('#nestable_parallel_' + i).nestable()
                    })
				},
				initTit: function(){
					$('.page-title h1').text(app.data.title)
					$('.page-title small').text(app.data.description)
				},
				end: function(){
					history.go(-1)
				},
				save: function(){
					app.methods.getSort()
					console.log(JSON.stringify(app.data.card_sort))
					// TODO
					// 格式化 并 保存
				},
				getSort: function(){
					app.data.card_main.map(function(__e, __i){
						app.data.card_sort[__i] = $('#nestable_list_' + __i).nestable('serialize')
					});
				},
			},
            init: function(){
				console.log(app.data.id)

				Metronic.init(); // init metronic core components
				
				app.methods.initTit()
				app.methods.initNestableHtml()
            }
        };

        jQuery(document).ready(function () {
            app.init()
        });
	</script>
	<!-- END JAVASCRIPTS -->
</body>
<!-- END BODY -->

</html>