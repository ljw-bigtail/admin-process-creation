<!DOCTYPE html>
<!-- 
Template Name: Metronic - Responsive Admin Dashboard Template build with Twitter Bootstrap 3.3.5
Version: 4.1.0
Author: KeenThemes
Website: http://www.keenthemes.com/
Contact: support@keenthemes.com
Follow: www.twitter.com/keenthemes
Like: www.facebook.com/keenthemes
Purchase: http://themeforest.net/item/metronic-responsive-admin-dashboard-template/4021469?ref=keenthemes
License: You must have a valid license purchased only from themeforest(the above link) in order to legally use the theme for your project.
-->
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<!-- BEGIN HEAD -->

<head>
	<meta charset="utf-8" />
	<title>Metronic | UI Features - Block UI</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta content="width=device-width, initial-scale=1.0" name="viewport" />
	<meta http-equiv="Content-type" content="text/html; charset=utf-8">
	<meta content="" name="description" />
	<meta content="" name="author" />
	<!-- BEGIN GLOBAL MANDATORY STYLES -->
	<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700&subset=all" rel="stylesheet"
		type="text/css">
	<link href="./plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
	<link href="./plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css">
	<link href="./plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css">
	<link href="./plugins/uniform/css/uniform.default.css" rel="stylesheet" type="text/css">
    <link href="./plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css" />
    <link href="./plugins/jquery-nestable/jquery.nestable.css"/ rel="stylesheet" type="text/css">
    
	<!-- END GLOBAL MANDATORY STYLES -->
	<!-- BEGIN THEME STYLES -->
	<link href="./css/components-rounded.css" id="style_components" rel="stylesheet" type="text/css" />
	<link href="./css/plugins.css" rel="stylesheet" type="text/css" />
	<link href="./css/layout.css" rel="stylesheet" type="text/css" />
	<link id="style_color" href="./css/themes/light.css" rel="stylesheet" type="text/css" />
	<link href="./css/custom.css" rel="stylesheet" type="text/css" />
	<!-- END THEME STYLES -->
    <link rel="shortcut icon" href="favicon.ico" />
    
    <style>
        .card_box{overflow-x: auto;}
        .card_box .full_width{width: max-content; display: flex; align-items: center}
        .card_box .full_width .portlet{display: inline-block; margin-right: 20px; width: 16vw; margin-bottom: 0; }
        .card_box .full_width .portlet .portlet-body{min-height: 60vh}

        .node_add{display: flex; align-items: center; justify-content: center}
        .node_add .fa{font-size: 40px;}

		.dd-item.grey{}
		/* case 0: className = 'grey';break;
		case 10: className = 'yellow';break;
		case 20: className = 'green';break;
		case 15: className = 'blue';break; */
		
    </style>
</head>
<!-- END HEAD -->
<!-- BEGIN BODY -->

<body class="page-header-fixed page-sidebar-closed-hide-logo ">
	<!-- BEGIN HEADER -->
	<div class="page-header navbar navbar-fixed-top">
		<!-- BEGIN HEADER INNER -->
		<div class="page-header-inner">
			<!-- BEGIN LOGO -->
			<div class="page-logo">
				<a href="index.html">
					<img src="./img/logo-light.png" alt="logo" class="logo-default" />
				</a>
				<div class="menu-toggler sidebar-toggler"></div>
			</div>
			<!-- END LOGO -->
			<!-- BEGIN PAGE TOP -->
			<div class="page-top">
				<!-- BEGIN TOP NAVIGATION MENU -->
				<div class="top-menu">
					<ul class="nav navbar-nav pull-right">
						<!-- BEGIN USER LOGIN DROPDOWN -->
						<li class="dropdown dropdown-user dropdown-dark">
							<a href="javascript:;" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">
								<span class="username username-hide-on-mobile"> Nick </span>
								<img alt="" class="img-circle" src="./img/avatar9.jpg" />
							</a>
							<ul class="dropdown-menu dropdown-menu-default">
								<li>
									<a href="login.html">
										<i class="icon-key"></i> Log Out </a>
								</li>
							</ul>
						</li>
						<!-- END USER LOGIN DROPDOWN -->
					</ul>
				</div>
				<!-- END TOP NAVIGATION MENU -->
			</div>
			<!-- END PAGE TOP -->
		</div>
		<!-- END HEADER INNER -->
	</div>
	<!-- END HEADER -->
	<div class="clearfix">
	</div>
	<!-- BEGIN CONTAINER -->
	<div class="page-container">
		<!-- BEGIN SIDEBAR -->
		<div class="page-sidebar-wrapper">
			<div class="page-sidebar navbar-collapse collapse">
				<!-- BEGIN SIDEBAR MENU -->
				<ul class="page-sidebar-menu " data-keep-expanded="false" data-auto-scroll="true"
					data-slide-speed="200">
					<li class="start ">
						<a href="./index.html">
							<i class="icon-home"></i>
							<span class="title">主页</span>
						</a>
					</li>
					<li class="last ">
						<a href="javascript:;">
							<i class="icon-basket"></i>
							<span class="title">流程</span>
							<span class="arrow "></span>
						</a>
						<ul class="sub-menu">
							<li>
								<a href="./card.html"><i class="icon-pencil"></i>流程管理</a>
							</li>
						</ul>
					</li>
				</ul>
				<!-- END SIDEBAR MENU -->
			</div>
		</div>
		<!-- END SIDEBAR -->
		<!-- BEGIN CONTENT -->
		<div class="page-content-wrapper">
			<div class="page-content">
				<!-- BEGIN PAGE HEADER-->
				<!-- BEGIN PAGE HEAD -->
				<div class="page-head">
					<!-- BEGIN PAGE TITLE -->
					<div class="page-title">
						<h1>流程 <small>流程管理</small></h1>
					</div>
					<!-- END PAGE TITLE -->
					<!-- BEGIN PAGE TOOLBAR -->
					<div class="page-toolbar">
						<!-- BEGIN THEME PANEL -->
						<div class="btn-group btn-theme-panel">
							<a href="javascript:;" class="btn dropdown-toggle" data-toggle="dropdown">
								<i class="icon-settings"></i>
							</a>
							<div class="dropdown-menu theme-panel pull-right dropdown-custom hold-on-click">
								<div class="row">
									<div class="col-md-12">
										<h3>THEME</h3>
										<ul class="theme-colors">
											<li class="theme-color theme-color-default" data-theme="default">
												<span class="theme-color-view"></span>
												<span class="theme-color-name">Dark Header</span>
											</li>
											<li class="theme-color theme-color-light active" data-theme="light">
												<span class="theme-color-view"></span>
												<span class="theme-color-name">Light Header</span>
											</li>
										</ul>
									</div>
								</div>
							</div>
						</div>
						<!-- END THEME PANEL -->
					</div>
					<!-- END PAGE TOOLBAR -->
				</div>
				<!-- END PAGE HEAD -->
				<!-- BEGIN PAGE BREADCRUMB -->
				<ul class="page-breadcrumb breadcrumb">
					<li>
						<a href="./index.html">Home</a>
						<i class="fa fa-circle"></i>
					</li>
					<li>
						<a href="#">流程</a>
						<i class="fa fa-circle"></i>
					</li>
					<li>
						<a href="#">流程管理</a>
					</li>
				</ul>
				<!-- END PAGE BREADCRUMB -->
				<!-- END PAGE HEADER-->
				<!-- BEGIN PAGE CONTENT-->
				<div class="portlet light card_box">
				    <div class="full_width"></div>
                </div>
				<!-- END PAGE CONTENT-->
			</div>
		</div>
		<!-- END CONTENT -->
	</div>
	<!-- END CONTAINER -->
	<!-- BEGIN FOOTER -->
	<div class="page-footer">
		<div class="page-footer-inner">
			2014 &copy; Metronic by keenthemes. 
			<a href="http://themeforest.net/item/metronic-responsive-admin-dashboard-template/4021469?ref=keenthemes" title="Purchase Metronic just for 27$ and get lifetime updates for free" target="_blank">Purchase Metronic!</a>
		</div>
		<div class="scroll-to-top">
			<i class="icon-arrow-up"></i>
		</div>
	</div>
	<!-- END FOOTER -->
	<!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->
	<!-- BEGIN CORE PLUGINS -->
	<!--[if lt IE 9]>
	<script src="./plugins/respond.min.js"></script>
	<script src="./plugins/excanvas.min.js"></script> 
	<![endif]-->
	<script src="./plugins/jquery.min.js" type="text/javascript"></script>
	<script src="./plugins/jquery-migrate.min.js" type="text/javascript"></script>
	<!-- IMPORTANT! Load jquery-ui.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->
	<script src="./plugins/jquery-ui/jquery-ui.min.js" type="text/javascript"></script>
	<script src="./plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
	<script src="./plugins/bootstrap-hover-dropdown/bootstrap-hover-dropdown.min.js" type="text/javascript"></script>
	<script src="./plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
	<script src="./plugins/jquery.blockui.min.js" type="text/javascript"></script>
	<script src="./plugins/jquery.cokie.min.js" type="text/javascript"></script>
	<script src="./plugins/uniform/jquery.uniform.min.js" type="text/javascript"></script>
    <script src="./plugins/jquery-nestable/jquery.nestable.js"></script>
    <script src="./plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>
    
	<!-- END CORE PLUGINS -->
	<script src="./js/metronic.js" type="text/javascript"></script>
    <script src="./js/layout.js" type="text/javascript"></script>
	<script>      
        var app = {
            data: {
				color: ['red','blue','green','yellow','purple'],
				// card node state =》 0, // 0 未开始，10 正在处理，20 已完成，15 延迟办理
                card: [{
                    title: '阶段1',
                    node:[{
                        id: 1,
                        text: '测试1',
                        state: 0,
                    },{
                        id: 2,
						text: '测试2',
                        state: 10,
                    },{
                        id: 3,
						text: '测试3',
                        state: 20,
                    },{
                        id: 4,
                        text: '测试4',
                        state: 15,
                    }]
                }],
                card_sort: [],
                max_node_len: 8,
            },
            methods: {
                initTheme: function(){
                    var panel = $('.theme-panel');
                    $('.theme-colors > li', panel).click(function () {
                        var color = $(this).attr("data-theme");
                        var color_ = (Metronic.isRTL() ? color + '-rtl' : color);
				        $('#style_color').attr("href", './css/themes/' + color_ + ".css");
                        $('ul > li', panel).removeClass("active");
                        $(this).addClass("active");

                        if (color === 'dark') {
                            $('.page-actions .btn').removeClass('red-haze').addClass('btn-default btn-transparent');
                        } else {
                            $('.page-actions .btn').removeClass('btn-default btn-transparent').addClass('red-haze');
                        }
                    });
				},
				stateToClass: function(state){
					var className = ''
					switch (state){
						case 0: className = 'grey';break;
						case 10: className = 'yellow';break;
						case 20: className = 'green';break;
						case 15: className = 'blue';break;
						// 0 未开始，10 正在处理，20 已完成，15 延迟办理
					}
					return className
				},
                initNestableHtml: function(){
                    var html = ''
                    app.data.card.map((e, i)=>{
                        app.data.card_sort.push([])
                        var _html = ''
                        e.node.map((_e, _i)=>{
                            _html += `<li class="dd-item dd3-item" data-id="${_e.id}">
                                <div class="dd-handle dd3-handle"></div>
                                <div class="dd3-content bg-${app.methods.stateToClass(_e.state)}">${_e.text}</div>
                            </li>`
                        })
                        html += `<div class="portlet box ${app.data.color[i % app.data.color.length]}">
                            <div class="portlet-title">
                                <div class="caption">${e.title}</div>
                            </div>
                            <div class="portlet-body">
                                <div class="dd" id="nestable_list_${i}">
                                    <ol class="dd-list">${_html}</ol>
                                </div>
                            </div>
                        </div>`
                    })
                    // xiaoyu 
                    if(app.data.card.length < app.data.max_node_len - 1){
                        html += `<div class="portlet box ${app.data.color[app.data.card.length % app.data.color.length]}">
                            <div class="portlet-title">
                                <div class="caption">新增阶段</div>
                            </div>
                            <div class="portlet-body node_add">
                                <i class="fa fa-plus"></i>
                            </div>
                        </div>`
                    }
                    $('.card_box .full_width').html(html)
                    app.data.card.map(function(e, i){
                        $('.card_box #nestable_list_' + i).nestable().on('change', (_e)=>{
                            app.data.card.map(function(__e, __i){
                                app.data.card_sort[__i] = $('#nestable_list_' + __i).nestable('serialize')
                            });
							console.log(app.data.card_sort)
							// TODO 排序接口

                        });
                    })
                }
            },
            init: function(){
                Metronic.init(); // init metronic core components
                Layout.init(); // init current layout
                app.methods.initTheme()
                app.methods.initNestableHtml()
            }
        };

        jQuery(document).ready(function () {
            app.init()
        });
	</script>
	<!-- END JAVASCRIPTS -->
</body>
<!-- END BODY -->

</html>